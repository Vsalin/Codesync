<!DOCTYPE html>
<html lang="en">
<head>
<title>CodeSync</title>
<style type="text/css" media="screen">
    #editor { 
        position: fixed; 
        top: 0;
        right: 0;
        bottom: 0;
        left: 160px; 
    }
      .navbar-fixed-left {
        width: 160px;
        position: fixed;
        border-radius: 0;
        height: 100%;
        background: black;
        top:0;
        left: 0;
        color: white;
      }

      /*.navbar-fixed-left .navbar-nav > li {
        float: none; 
        width: 100%;
      }*/

      .navbar-fixed-left + .container {
        padding-left: 170px;
      }

</style>
</head>
<body>

<div class="navbar-fixed-left">
  <ul class="nav navbar-nav">
   <li id ="directory">Directory file</li>
  </ul>
</div>
<div class="container">
  <div id="editor">
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.7/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>
     var editor = ace.edit("editor");
     editor.setTheme("ace/theme/twilight");
     editor.getSession().setMode("ace/mode/javascript");
     editor.$blockScrolling = Infinity;
    

    $.ajax({
      method: "POST",
      url: "/list",
      data: "",
      contentType: "application/JSON",  
      dataType: "JSON"
    }).done(function(data) {  
            data.forEach((file) => {
              $('#directory').append('<li><a><a href="#" data-path="' + file + '">' + file + '</a></li>')
            })
  }).fail(function (jqXHR, exception) {
    var msg = '';
    if (jqXHR.status === 0) {
        msg = 'Not connect.\n Verify Network.';
    } else if (jqXHR.status == 404) {
        msg = 'Requested page not found. [404]';
    } else if (jqXHR.status == 500) {
        msg = 'Internal Server Error [500].';
    } else if (exception === 'parsererror') {
        msg = 'Requested JSON parse failed.';
    } else if (exception === 'timeout') {
        msg = 'Time out error.';
    } else if (exception === 'abort') {
        msg = 'Ajax request aborted.';
    } else {
        msg = 'Uncaught Error.\n' + jqXHR.responseText;
    }
    alert(msg);
});
</script>
<script src="/socket.io/socket.io.js"></script>
<script>
  
  var socket = io('http://localhost:3000');
  $(function() {
    $('#directory').on('click', 'li > a', function(event) {
     // console.log($(this).data('path'))
     var datafile = $(this).data('path')
     console.log(datafile)
        $.ajax({
        method: "POST",
        url: "/showfile",
        data: JSON.stringify({a : datafile}),
        contentType: "application/JSON",  
        //  dataType: "JSON"
    }).done(function(data) {  
        
        editor.setValue(data.data); 
        // socket.on('refresh', function () {
        //     editor.setValue(data.data);
        // });
        editor.on('change', function (op) {
            // console.log(op);
            socket.emit('change', op);
            // socket.emit('refresh', editor.getValue());
        });
        socket.on('change', function (data) {
            var rang = new Range(data.start.row, data.start.column, data.end.row,data.end.column)
            editor.replace(rang,data.lines);
        });

    }).fail(function (jqXHR, exception) {
    var msg = '';
    if (jqXHR.status === 0) {
        msg = 'Not connect.\n Verify Network.';
    } else if (jqXHR.status == 404) {
        msg = 'Requested page not found. [404]';
    } else if (jqXHR.status == 500) {
        msg = 'Internal Server Error [500].';
    } else if (exception === 'parsererror') {
        msg = 'Requested JSON parse failed.';
    } else if (exception === 'timeout') {
        msg = 'Time out error.';
    } else if (exception === 'abort') {
        msg = 'Ajax request aborted.';
    } else {
        msg = 'Uncaught Error.\n' + jqXHR.responseText;
    }
        alert(msg);
    });
});

});

</script>

</body>
</html>
